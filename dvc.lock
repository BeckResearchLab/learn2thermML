schema: '2.0'
stages:
  ogt_protein_classifier_train_evaluate:
    cmd: torchrun --nproc_per_node gpu pipeline/ogt_protein_classifier_train_evaluate.py
    deps:
    - path: ./data/ogt_protein_classifier/data
      md5: 01ab7e5da161e6c97c7309d6e9f0fd14.dir
      size: 1252068169
      nfiles: 267
    - path: ./l2tml_utils/model_utils.py
      md5: 13c9597c906c8f2291cc7902be3c622d
      size: 4167
    - path: ./pipeline/ogt_protein_classifier_train_evaluate.py
      md5: 448657f641b9433869417ae84d156631
      size: 14934
    params:
      params.yaml:
        ogt_protein_classifier_train_evaluate.batch_size: 32
        ogt_protein_classifier_train_evaluate.dev_subsample_data: false
        ogt_protein_classifier_train_evaluate.dropout: 0.1
        ogt_protein_classifier_train_evaluate.epochs: 2
        ogt_protein_classifier_train_evaluate.fp16: true
        ogt_protein_classifier_train_evaluate.grad_accum: 25
        ogt_protein_classifier_train_evaluate.grad_checkpointing: true
        ogt_protein_classifier_train_evaluate.lr: 5e-05
        ogt_protein_classifier_train_evaluate.lr_scheduler: linear
        ogt_protein_classifier_train_evaluate.model: protbert
        ogt_protein_classifier_train_evaluate.n_save_per_epoch: 10
        ogt_protein_classifier_train_evaluate.protocol: finetune
        ogt_protein_classifier_train_evaluate.push: true
    outs:
    - path: ./data/ogt_protein_classifier/dvclive/metrics.json
      md5: a5fe5da9b15a6425a62380d42a63639a
      size: 359
    - path: ./data/ogt_protein_classifier/dvclive/plots
      md5: 20ae40b4aca0cb43092324081d866311.dir
      size: 739
      nfiles: 10
    - path: ./data/ogt_protein_classifier/dvclive/report.md
      md5: ca5613a8980b3d5c009ad80e5c5cb6a9
      size: 1056
    - path: ./data/ogt_protein_classifier/model
      md5: daff70e62691ee6f4cf06367ff4497ff.dir
      size: 10080146653
      nfiles: 28
    - path: ./data/ogt_protein_classifier/model_metrics.yaml
      md5: 6213a376bf4aa0ba7ba2d67d4e5d9132
      size: 1566
  ogt_protein_classifier_data_prep:
    cmd: python pipeline/ogt_protein_classifier_data_prep.py
    deps:
    - path: ./data/database
      md5: 5192612c6c18eeadaaf37a1ee14f307f
      size: 9478352896
    - path: ./l2tml_utils/data_utils.py
      md5: ba2e01531846874788d5dbe899079b1f
      size: 9557
    - path: ./l2tml_utils/dataset_deduplication.py
      md5: 99f75aae0fd91b47a18988dd609b3cc6
      size: 12357
    - path: ./pipeline/ogt_protein_classifier_data_prep.py
      md5: 090e7ebe6774ed9aaa08702c8fb16265
      size: 9695
    params:
      params.yaml:
        ogt_protein_classifier_data_prep.data_batch_size: 200
        ogt_protein_classifier_data_prep.deduplication:
        - do: true
        - jaccard: 0.6
        - kgram: 3
        - num_perm: 100
        ogt_protein_classifier_data_prep.dev_keep_columns: false
        ogt_protein_classifier_data_prep.dev_sample_init_data: false
        ogt_protein_classifier_data_prep.max_protein_len: 250
        ogt_protein_classifier_data_prep.max_upsampling: 0.0
        ogt_protein_classifier_data_prep.min_balance: 0.5
        ogt_protein_classifier_data_prep.ogt_window:
        - 30.0
        - 60.0
        ogt_protein_classifier_data_prep.split_type: random
        ogt_protein_classifier_data_prep.train_test_frac: 0.1
    outs:
    - path: ./data/ogt_protein_classifier/data
      md5: 734ab823facec9792c543289f7681c76.dir
      size: 53679113
      nfiles: 7
    - path: ./data/ogt_protein_classifier/data_metrics.yaml
      md5: e4667c09e02a45d1cddea31669e48be0
      size: 170
  ogt_protein_regressor_data_prep:
    cmd: python pipeline/ogt_protein_regressor_data_prep.py
    deps:
    - path: ./data/database
      md5: 3d1fb0c6b918014c9959ebab31ca9c32
      size: 34096820224
    - path: ./l2tml_utils/data_utils.py
      md5: ba2e01531846874788d5dbe899079b1f
      size: 9557
    - path: ./l2tml_utils/dataset_deduplication.py
      md5: 99f75aae0fd91b47a18988dd609b3cc6
      size: 12357
    - path: ./pipeline/ogt_protein_regressor_data_prep.py
      md5: 8e3e2a9d745f06f2c691edc71a9dab47
      size: 7933
    params:
      params.yaml:
        ogt_protein_regressor_data_prep.balancing:
        - do: true
        - max_bin_size: auto
        - num_bins: 20
        - min_total_data_kept: 150000
        ogt_protein_regressor_data_prep.data_batch_size: 200
        ogt_protein_regressor_data_prep.deduplication:
        - do: true
        - jaccard: 0.6
        - kgram: 3
        - num_perm: 100
        ogt_protein_regressor_data_prep.dev_keep_columns: false
        ogt_protein_regressor_data_prep.dev_sample_init_data: false
        ogt_protein_regressor_data_prep.max_protein_len: 250
        ogt_protein_regressor_data_prep.min_protein_len: 50
        ogt_protein_regressor_data_prep.split_type: random
        ogt_protein_regressor_data_prep.train_test_frac: 0.1
    outs:
    - path: ./data/ogt_protein_regressor/data
      md5: e606be7fef30a27c9a44efbf03177e3b.dir
      size: 27218021
      nfiles: 7
    - path: ./data/ogt_protein_regressor/data_metrics.yaml
      md5: 9c67e992166d6b4d4acb40230e07e221
      size: 208
  ogt_protein_regressor_train_evaluate:
    cmd: torchrun --nproc_per_node gpu pipeline/ogt_protein_regressor_train_evaluate.py
    deps:
    - path: ./data/ogt_protein_regressor/data
      md5: f4b892fb82dec9f31c35b38cd3642b82.dir
      size: 28094605
      nfiles: 12
    - path: ./l2tml_utils/model_utils.py
      md5: 13c9597c906c8f2291cc7902be3c622d
      size: 4167
    - path: ./pipeline/ogt_protein_regressor_train_evaluate.py
      md5: b8e9532770a2c7bd10fbe6dd9a0448a2
      size: 13213
    params:
      params.yaml:
        ogt_protein_regressor_train_evaluate.batch_size: 40
        ogt_protein_regressor_train_evaluate.dev_subsample_data: 80
        ogt_protein_regressor_train_evaluate.dropout: 0.0
        ogt_protein_regressor_train_evaluate.epochs: 25
        ogt_protein_regressor_train_evaluate.fp16: true
        ogt_protein_regressor_train_evaluate.grad_accum: 1
        ogt_protein_regressor_train_evaluate.grad_checkpointing: true
        ogt_protein_regressor_train_evaluate.lr: 5e-05
        ogt_protein_regressor_train_evaluate.lr_scheduler: linear
        ogt_protein_regressor_train_evaluate.model: protbert
        ogt_protein_regressor_train_evaluate.n_save_per_epoch: 1
        ogt_protein_regressor_train_evaluate.protocol: finetune
    outs:
    - path: ./data/ogt_protein_regressor/dvclive/metrics.json
      md5: 28d3164e35f0861815d61515452dc733
      size: 376
    - path: ./data/ogt_protein_regressor/dvclive/plots
      md5: 216c1251aedffd536260ac93998741ec.dir
      size: 1577
      nfiles: 11
    - path: ./data/ogt_protein_regressor/dvclive/report.md
      md5: 9aef0d3565cdc8dd3c7b7b300062a089
      size: 1119
    - path: ./data/ogt_protein_regressor/model
      md5: 72fc37f811e9f4e5180f74e8efa491e5.dir
      size: 15120772283
      nfiles: 47
    - path: ./data/ogt_protein_regressor/model_metrics.yaml
